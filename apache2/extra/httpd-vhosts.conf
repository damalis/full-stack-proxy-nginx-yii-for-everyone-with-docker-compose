# Virtual Hosts
#
# Required modules: mod_log_config

# If you want to maintain multiple domains/hostnames on your
# machine you can setup VirtualHost containers for them. Most configurations
# use only name-based virtual hosts so the server doesn't need to worry about
# IP addresses. This is indicated by the asterisks in the directives below.
#
# Please see the documentation at 
# <URL:http://httpd.apache.org/docs/2.4/vhosts/>
# for further details before you try to setup virtual hosts.
#
# You may use the command line option '-S' to verify your virtual host
# configuration.

#
# VirtualHost example:
# Almost any Apache directive may go into a VirtualHost container.
# The first VirtualHost section is used for all requests that do not
# match a ServerName or ServerAlias in any <VirtualHost> block.
#

ServerName localhost

LoadModule rewrite_module /usr/local/apache2/modules/mod_rewrite.so
LoadModule deflate_module /usr/local/apache2/modules/mod_deflate.so
LoadModule proxy_module /usr/local/apache2/modules/mod_proxy.so
LoadModule proxy_fcgi_module /usr/local/apache2/modules/mod_proxy_fcgi.so

<VirtualHost *:8080>
    ServerName frontend.test
    ProxyPassMatch ^/(.*\.php(/.*)?)$ fcgi://yiiframework:9000/var/www/html/$1
	DocumentRoot "/var/www/html/"
    <Directory />
        Options FollowSymLinks
        AllowOverride None
    </Directory>
    <Directory "/var/www/html/">
        # use mod_rewrite for pretty URL support
        RewriteEngine on
        # If a directory or a file exists, use the request directly
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        # Otherwise forward the request to index.php
        RewriteRule . index.php

        # use index.php as index file
        DirectoryIndex index.php
		Options Indexes FollowSymLinks
        # ...other settings...
        # Apache 2.4
        Require all granted
            
        ## Apache 2.2
        AllowOverride All
		Order allow,deny
		allow from all
    </Directory>
		
	# Send apache logs to stdout and stderr
    CustomLog /proc/self/fd/1 common
    ErrorLog /proc/self/fd/2
</VirtualHost>
    
<VirtualHost *:8080>
    ServerName backend.test
	ProxyPassMatch ^/(.*\.php(/.*)?)$ fcgi://yiiframework:9000/var/www/html/backend/web/$1
    DocumentRoot "/var/www/html/backend/web/"
        
    <Directory "/var/www/html/backend/web/">
        # use mod_rewrite for pretty URL support
        RewriteEngine on
        # If a directory or a file exists, use the request directly
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        # Otherwise forward the request to index.php
        RewriteRule . index.php

        # use index.php as index file
        DirectoryIndex index.php
		Options Indexes FollowSymLinks
        # ...other settings...
        # Apache 2.4
        Require all granted
            
        ## Apache 2.2
        Order allow,deny
        Allow from all
    </Directory>
</VirtualHost>
